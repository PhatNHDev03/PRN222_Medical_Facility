@page
@model MedicaiFacility.RazorPage.Pages.MedicalHistories.MyMedicalHistoryModel
@{
}@if (TempData["SuccessMessage"] != null)
{
	<div class="alert alert-success">@TempData["SuccessMessage"]</div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
}
<table class="table table-hover table-striped table-bordered table-responsive">
	<thead class="thead-dark">
		<tr>
			<th>History ID</th>
			<th>Description</th>
			<th>History Status</th>
			<th>Created At</th>
			<th>Updated At</th>
			<th>Start Date</th>
			<th>End Date</th>
			<th>Appointment Status</th>
			<th>Patient Info</th>
			<th>Expert Info</th>
			@if (User.FindFirstValue(ClaimTypes.Role) == "MedicalExpert")
			{
				<th>Pay</th>
			}   
			<th>Actions</th>
		</tr>
	</thead>
	<tbody>
		@foreach (var history in Model.MedicalHistoryViewModels)
		{
			<tr>
				<td>@history.HistoryId</td>
				<td>@(history.Description ?? "No Description")</td>
				<td>@(history.Status ?? "Unknown")</td>
				<td>@(history.CreatedAt?.ToString("yyyy-MM-dd HH:mm") ?? "N/A")</td>
				<td>@(history.UpdatedAt?.ToString("yyyy-MM-dd HH:mm") ?? "N/A")</td>
				<td>@history.StartDate.ToString("yyyy-MM-dd HH:mm")</td>
				<td>@(history.EndDate?.ToString("yyyy-MM-dd HH:mm") ?? "N/A")</td>
				<td>@(history.AppointmentStatus ?? "N/A")</td>
				<td>@(history.patientInfor ?? "Unknown")</td>
				<td>@(history.ExpertInfor ?? "Unknown")</td>
				@if (User.FindFirstValue(ClaimTypes.Role) == "MedicalExpert")
				{
					<td>@(history.Pay == true ? "Paid" : "not yet paid")</td>
				}
				<td>
					<button class="btn btn-primary" onclick="window.location.href='@Url.Page("/MedicalHistories/Detail", new { id = history.HistoryId })'"> History Detail</button>
					@if (history.Status == "Completed")
					{
                        <button class="btn btn-primary" onclick="window.location.href='@Url.Page("/HealthRecords/Detail", new { id = history.HistoryId })'"> Health Record Detail</button>


                        <form asp-page-handler="MyCreate" asp-route-id="@history.HistoryId" method="post">

                            <button type="submit">View Rating and feedback</button>
                        </form>
					}

					@if (User.FindFirstValue(ClaimTypes.Role) == "MedicalExpert")
					{
						if (history.Status != "Cancel" && history.Status != "Completed" && history.Status != "Incomplete")
						{
							<button class="btn btn-warning btn-sm" onclick="openModal( @history.HistoryId)">Edit</button>
						}
						if (history.Status == "Completed")
						{
                        }

					}

				</td>
			</tr>
		}
	</tbody>
</table>





    @if (Model.Pager.TotalPages > 0)
    {
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-end">
                @if (Model.Pager.CurrentPage > 1)
                {
                    <li class="page-item">
                        <a class="page-link" asp-page="/MedicalHistories/MyMedicalHistory" asp-route-pg="@(Model.Pager.StartPage)">First</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" asp-page="/MedicalHistories/MyMedicalHistory" asp-route-pg="@(Model.Pager.CurrentPage - 1)">Previous</a>
                    </li>
                }
                @for (var pge = Model.Pager.StartPage; pge <= Model.Pager.EndPage; pge++)
                {
                    <li class="page-item @(pge == Model.Pager.CurrentPage ? "active" : "")">
                        <a class="page-link" asp-page="/MedicalHistories/MyMedicalHistory" asp-route-pg="@pge">@pge</a>
                    </li>
                }
                @if (Model.Pager.CurrentPage < Model.Pager.TotalPages)
                {
                    <li class="page-item">
                        <a class="page-link" asp-page="/MedicalHistories/MyMedicalHistory" asp-route-pg="@(Model.Pager.CurrentPage + 1)">Next</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" asp-page="/MedicalHistories/MyMedicalHistory" asp-route-pg="@(Model.Pager.TotalPages)">Last</a>
                    </li>
                }
            </ul>
        </nav>
    }
</div>

<!-- Custom CSS -->
<style>
    /* Table Styling */
    .table-custom {
        width: 100%;
        margin-top: 20px;
        border-collapse: collapse;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

        /* Table header */
        .table-custom thead {
            background-color: #343a40;
            color: white;
            text-transform: uppercase;
        }

        /* Table header and cells */
        .table-custom th, .table-custom td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

            /* Bo góc cho ô đầu và cuối mỗi hàng */
            .table-custom td:first-child,
            .table-custom th:first-child {
                border-top-left-radius: 8px;
                border-bottom-left-radius: 8px;
            }

            .table-custom td:last-child,
            .table-custom th:last-child {
                border-top-right-radius: 8px;
                border-bottom-right-radius: 8px;
            }

        /* Hover Effect */
        .table-custom tbody tr:hover {
            background-color: rgba(0, 123, 255, 0.1); /* Làm nổi bật hàng khi hover */
            transition: background 0.3s ease-in-out;
        }

    /* Button spacing */
    .btn-action {
        margin-right: 5px;
        margin-bottom: 5px;
    }

    /* Trạng thái */
    .status-confirmed {
        background-color: #28a745;
        color: #fff;
        padding: 3px 10px;
        border-radius: 5px;
    }

    /* Pagination */
    .pagination {
        margin-top: 20px;
    }

        .pagination .page-item {
            margin: 0 5px;
        }

        .pagination .page-link {
            color: #007bff;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .pagination .page-item.active .page-link {
            background-color: #007bff;
            color: #fff;
            border-color: #007bff;
        }

        /* Hover cho nút chuyển trang */
        .pagination .page-link:hover {
            background-color: rgba(0, 123, 255, 0.2);
        }


   
</style>

